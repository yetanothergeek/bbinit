#!/bin/false
# -*- mode: sh; -*-

# network
task_start () {
echo 'Configuring network interfaces...'
[ -f /etc/hostname ] && hostname -F /etc/hostname
ifconfig lo 127.0.0.1 up netmask 255.0.0.0
[ -f /etc/mactab ] && nameif -c /etc/mactab
if [ -f /etc/network/interfaces ] ; then
  IfUp () { SHELL=/lib/bb/sh ifup $@ ; } # Need busybox SHELL for run-parts
  if grep -qw dhcp /etc/network/interfaces ; then
    if IfUp -anm | grep -q '^udhcpc ' ; then
     local UDHCPC_SCRIPT=$(udhcpc --help 2>&1 | awk '/^[\t ]+-s / {
       sub(/^[^\/]+/,"");
       sub(/)$/,""); print
     }')
     if [ ! -e "$UDHCPC_SCRIPT" ] ; then
       local UDHCPC_SCRIPT_DIR=$(dirname "$UDHCPC_SCRIPT")
       if mkdir -p "$UDHCPC_SCRIPT_DIR" 2> /dev/null ; then
         ln -s /etc/bb.d/exec/udhcpc.sh "$UDHCPC_SCRIPT"
       fi
     fi
    fi
  fi
  local PROG MSG
  IfUp -a 2>&1  | while read PROG MSG ; do
    case "$PROG" in
      udhcpc*) logger -t "${PROG/:/}" -p daemon.notice "$MSG" ;;
      *) logger -s -t "${PROG/:/}" -p daemon.warn "$MSG" ;;
    esac
  done &
  unset -f IfUp
fi
}

